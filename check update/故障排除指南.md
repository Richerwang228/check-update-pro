# hsex.men è¿æ¥é—®é¢˜æ•…éšœæ’é™¤æŒ‡å—

## ğŸš¨ å½“å‰é—®é¢˜åˆ†æ

æ ¹æ®æ—¥å¿—ä¿¡æ¯ï¼Œæ‚¨é‡åˆ°äº†ä»¥ä¸‹ä¸¤ç§ä¸»è¦é”™è¯¯ï¼š

### 1. ConnectionResetError(10054)
```
è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥
```
**æ ¹æœ¬åŸå› **: 
- ç›®æ ‡ç½‘ç«™ä¸»åŠ¨æ‹’ç»è¿æ¥
- Cloudflareé˜²æŠ¤æœºåˆ¶è§¦å‘
- ç½‘ç»œé˜²ç«å¢™/ISPé™åˆ¶
- ä»£ç†æœåŠ¡å™¨è¢«ç›®æ ‡ç½‘ç«™å±è”½

### 2. ProxyError - ä»£ç†è¿æ¥è¶…æ—¶
```
Connection to 8.210.83.33 timed out
```
**æ ¹æœ¬åŸå› **:
- å…è´¹ä»£ç†IPå·²å¤±æ•ˆ
- ä»£ç†æœåŠ¡å™¨å®•æœºæˆ–ä¸å¯è¾¾
- ä»£ç†è¢«ç›®æ ‡ç½‘ç«™åŠ å…¥é»‘åå•

## ğŸ” é—®é¢˜è¯Šæ–­

### è¿è¡Œè¯Šæ–­è„šæœ¬
```bash
python diagnose_connection.py
```

è¯Šæ–­è„šæœ¬å°†æµ‹è¯•ï¼š
- DNSè§£æèƒ½åŠ›
- ç«¯å£è¿æ¥çŠ¶æ€
- SSLæ¡æ‰‹
- HTTPè¯·æ±‚å“åº”
- Cloudflareæ£€æµ‹
- ä»£ç†å¯ç”¨æ€§

### æ‰‹åŠ¨è¯Šæ–­æ­¥éª¤

1. **æµè§ˆå™¨æµ‹è¯•**
   - ç”¨æµè§ˆå™¨è®¿é—® `https://hsex.men/user.htm?author=345061255`
   - è§‚å¯Ÿæ˜¯å¦å‡ºç°CloudflareéªŒè¯é¡µé¢
   - è®°å½•åŠ è½½æ—¶é—´

2. **å‘½ä»¤è¡Œæµ‹è¯•**
   ```bash
   # æµ‹è¯•DNS
   nslookup hsex.men
   
   # æµ‹è¯•ç«¯å£è¿é€šæ€§
   telnet hsex.men 443
   
   # æµ‹è¯•HTTPå“åº”
   curl -I https://hsex.men/user.htm?author=345061255
   ```

## ğŸ’¡ è§£å†³æ–¹æ¡ˆå±‚çº§

### ğŸ¥‡ æœ€ä½³æ–¹æ¡ˆï¼šä»˜è´¹ä»£ç†æœåŠ¡

**æ¨èæœåŠ¡å•†**:
1. **Bright Data** (ä½å®…ä»£ç†)
   - æˆåŠŸç‡: 95%+
   - ä»·æ ¼: $15/GBèµ·
   - ç‰¹ç‚¹: çœŸå®ä½å®…IPï¼ŒCloudflareç»•è¿‡èƒ½åŠ›å¼º

2. **Oxylabs** (ä½å®…ä»£ç†)
   - æˆåŠŸç‡: 90%+
   - ä»·æ ¼: $12/GBèµ·
   - ç‰¹ç‚¹: å…¨çƒIPæ± ï¼Œç¨³å®šå¯é 

3. **Smartproxy** (ä½å®…ä»£ç†)
   - æˆåŠŸç‡: 85%+
   - ä»·æ ¼: $7.5/GBèµ·
   - ç‰¹ç‚¹: æ€§ä»·æ¯”é«˜ï¼Œæ˜“äºé›†æˆ

**é…ç½®ç¤ºä¾‹**:
```python
# åœ¨ anti_ban_config.py ä¸­é…ç½®
PROXY_POOL = [
    {"http": "http://username:password@residential-proxy:port"},
    {"https": "http://username:password@residential-proxy:port"}
]
```

### ğŸ¥ˆ æ¬¡ä¼˜æ–¹æ¡ˆï¼šæµè§ˆå™¨è‡ªåŠ¨åŒ–

**ä½¿ç”¨Selenium**:
```python
from selenium import webdriver
from selenium.webdriver.chrome.options import Options

options = Options()
options.add_argument('--headless')
options.add_argument('--no-sandbox')
options.add_argument('--disable-dev-shm-usage')
options.add_argument('--disable-blink-features=AutomationControlled')
options.add_experimental_option("excludeSwitches", ["enable-automation"])

driver = webdriver.Chrome(options=options)
driver.get("https://hsex.men/user.htm?author=345061255")
```

**ä½¿ç”¨Playwright**:
```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=True)
    page = browser.new_page()
    page.goto("https://hsex.men/user.htm?author=345061255")
    content = page.content()
    browser.close()
```

### ğŸ¥‰ åº”æ€¥æ–¹æ¡ˆï¼šé¢‘ç‡æ§åˆ¶

**æç«¯ä¿å®ˆé…ç½®**:
```python
# åœ¨ anti_ban_config.py ä¸­
MIN_INTERVAL = 60  # æœ€å°é—´éš”60ç§’
MAX_INTERVAL = 120  # æœ€å¤§é—´éš”120ç§’
MAX_RETRIES = 3    # å‡å°‘é‡è¯•æ¬¡æ•°
```

**ä½¿ç”¨ç­–ç•¥**:
- æ¯æ¬¡è¯·æ±‚åç­‰å¾…60-120ç§’
- ä½¿ç”¨éšæœºUser-Agentè½®æ¢
- é¿å…è¿ç»­è¯·æ±‚åŒä¸€é¡µé¢

## ğŸ› ï¸ ç«‹å³å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šè¿è¡Œè¯Šæ–­
```bash
python diagnose_connection.py
```

### æ­¥éª¤2ï¼šé€‰æ‹©è§£å†³æ–¹æ¡ˆ

**å¦‚æœè¯Šæ–­æ˜¾ç¤ºCloudflareé˜»æ–­**:
1. æ³¨å†Œä»˜è´¹ä»£ç†æœåŠ¡
2. æ›´æ–°ä»£ç†é…ç½®
3. é‡æ–°è¿è¡Œçˆ¬è™«

**å¦‚æœè¯Šæ–­æ˜¾ç¤ºç½‘ç»œé—®é¢˜**:
1. æ£€æŸ¥æœ¬åœ°ç½‘ç»œ
2. å°è¯•ä½¿ç”¨VPN
3. æ›´æ¢ç½‘ç»œç¯å¢ƒ

**å¦‚æœè¯Šæ–­æ˜¾ç¤ºä»£ç†å¤±æ•ˆ**:
1. ç§»é™¤å¤±æ•ˆä»£ç†
2. ä»…ä½¿ç”¨ç›´è¿æ¨¡å¼
3. å¢åŠ è¯·æ±‚é—´éš”

### æ­¥éª¤3ï¼šç›‘æ§æ•ˆæœ

**æŸ¥çœ‹å®æ—¶æ—¥å¿—**:
```bash
tail -f logs/scraper.log
```

**æˆåŠŸç‡ç»Ÿè®¡**:
```python
# åœ¨ä»£ç ä¸­æ·»åŠ ç»Ÿè®¡
success_count = 0
total_count = 0
for url in urls:
    result = scraper.get_page_content(url)
    total_count += 1
    if result:
        success_count += 1
    
    success_rate = (success_count / total_count) * 100
    print(f"æˆåŠŸç‡: {success_rate:.1f}% ({success_count}/{total_count})")
```

## ğŸ“Š é¢„æœŸæ•ˆæœå¯¹æ¯”

| è§£å†³æ–¹æ¡ˆ | æˆåŠŸç‡ | æˆæœ¬ | å®æ–½éš¾åº¦ | å¤‡æ³¨ |
|---------|--------|------|----------|------|
| ä»˜è´¹ä»£ç† | 90-95% | é«˜ | ä½ | æ¨èæ–¹æ¡ˆ |
| æµè§ˆå™¨è‡ªåŠ¨åŒ– | 80-90% | ä¸­ | ä¸­ | éœ€è¦ç»´æŠ¤ |
| é¢‘ç‡æ§åˆ¶ | 30-50% | ä½ | ä½ | ä»…åº”æ€¥ä½¿ç”¨ |
| å…è´¹ä»£ç† | 10-20% | å…è´¹ | é«˜ | åŸºæœ¬æ— æ•ˆ |

## ğŸ”§ é«˜çº§æŠ€å·§

### 1. ä»£ç†è½®æ¢ç­–ç•¥
```python
# æ™ºèƒ½ä»£ç†é€‰æ‹©
def get_working_proxy(self):
    for proxy in self.proxies:
        if self.test_proxy_health(proxy):
            return proxy
    return None

def test_proxy_health(self, proxy):
    try:
        response = requests.get(
            "https://httpbin.org/ip",
            proxies={'https': proxy},
            timeout=5
        )
        return response.status_code == 200
    except:
        return False
```

### 2. è¯·æ±‚æŒ‡çº¹ä¼ªè£…
```python
# æ›´çœŸå®çš„æµè§ˆå™¨æŒ‡çº¹
headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
    'Accept-Language': 'zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7',
    'Accept-Encoding': 'gzip, deflate, br',
    'Cache-Control': 'no-cache',
    'Pragma': 'no-cache',
    'Sec-Ch-Ua': '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
    'Sec-Ch-Ua-Mobile': '?0',
    'Sec-Ch-Ua-Platform': '"Windows"',
    'Sec-Fetch-Dest': 'document',
    'Sec-Fetch-Mode': 'navigate',
    'Sec-Fetch-Site': 'none',
    'Sec-Fetch-User': '?1',
    'Upgrade-Insecure-Requests': '1'
}
```

### 3. ä¼šè¯ç®¡ç†
```python
# ç»´æŠ¤ä¼šè¯çŠ¶æ€
session = requests.Session()
session.cookies.set('timezone', 'Asia/Shanghai')
session.cookies.set('language', 'zh-CN')
session.cookies.set('accept', 'text/html,application/xhtml+xml')
```

## ğŸš¨ é‡è¦æé†’

### æ³•å¾‹åˆè§„
- ç¡®ä¿çˆ¬å–è¡Œä¸ºç¬¦åˆç½‘ç«™robots.txt
- éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„
- å°Šé‡ç½‘ç«™æœåŠ¡æ¡æ¬¾

### å®é™…é™åˆ¶
- **å…è´¹ä»£ç†**: åŸºæœ¬æ— æ³•ç»•è¿‡Cloudflare
- **é¢‘ç‡é™åˆ¶**: è¿‡ä½çš„é¢‘ç‡ä¼šå½±å“æ•ˆç‡
- **æŠ€æœ¯å¯¹æŠ—**: ç½‘ç«™é˜²æŠ¤ä¼šä¸æ–­å‡çº§

### é•¿æœŸå»ºè®®
1. **æŠ•èµ„ä»˜è´¹ä»£ç†**: è¿™æ˜¯æœ€å¯é çš„è§£å†³æ–¹æ¡ˆ
2. **ä½¿ç”¨ä¸“ä¸šå·¥å…·**: è€ƒè™‘Scrapy Cloudã€Apifyç­‰å¹³å°
3. **ç›‘æ§ç»´æŠ¤**: å®šæœŸæ£€æŸ¥ä»£ç†å¯ç”¨æ€§å’Œçˆ¬è™«æ•ˆæœ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°ä»¥ä¸‹æƒ…å†µï¼Œå»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©ï¼š
- æ‰€æœ‰ä»£ç†éƒ½æ— æ³•è¿æ¥
- æµè§ˆå™¨è‡ªåŠ¨åŒ–ä¹Ÿè¢«é˜»æ­¢
- éœ€è¦å¤§è§„æ¨¡æ•°æ®çˆ¬å–
- å¯¹æˆåŠŸç‡è¦æ±‚æé«˜

**è”ç³»æ–¹å¼**: 
- ä»£ç†æœåŠ¡å•†æŠ€æœ¯æ”¯æŒ
- ä¸“ä¸šçˆ¬è™«å¼€å‘å›¢é˜Ÿ
- ç½‘ç»œå®‰å…¨ä¸“å®¶å’¨è¯¢

---

**æ€»ç»“**: æ‚¨é‡åˆ°çš„é—®é¢˜ä¸»è¦æ˜¯Cloudflareé˜²æŠ¤å’Œä»£ç†å¤±æ•ˆå¯¼è‡´çš„ã€‚å»ºè®®ç«‹å³æ³¨å†Œä»˜è´¹ä»£ç†æœåŠ¡ï¼Œè¿™æ˜¯æœ€å¯é çš„è§£å†³æ–¹æ¡ˆã€‚é¢„ç®—æœ‰é™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘æµè§ˆå™¨è‡ªåŠ¨åŒ–æ–¹æ¡ˆï¼Œä½†éœ€è¦æ›´å¤šçš„ç»´æŠ¤å·¥ä½œã€‚